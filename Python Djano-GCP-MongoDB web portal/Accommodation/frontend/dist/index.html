<!DOCTYPE HTML>
<html lang="en">
    <head>
        <title>AirNSW - Homepage</title>
        {% include 'head.html' %}
    </head>

    
    <body>
        <!--loader-->
        <div class="loader-wrap">
            <div class="pin">
                <div class="pulse"></div>
            </div>
        </div>
        <!--loader end-->
        <!-- Main  -->
        <div id="main">
            <!-- header-->
            <header class="main-header">
                {% include 'header.html' %}
            </header>
            <!--  header end -->
            <!--  wrapper  -->
            <div id="wrapper">
                <!-- content-->
                <div class="content">
                    {% include 'chatbot.html' %}
                    <!--section -->
                    <section class="hero-section" data-scrollax-parent="true" id="sec1">
                        <div class="hero-parallax">
                            <div class="media-container video-parallax" data-scrollax="properties: { translateY: '200px' }">
                                <div class="bg mob-bg" style="background-image: url(../static/images/bg/1.jpg)"></div>
                                <div class="video-container">
                                    <video autoplay  loop muted  class="bgvid">
                                        <source src="../static/images/syd.mov" type="video/mp4">
                                    </video>
                                </div>
                            </div>
                            <div class="overlay op7"></div>
                        </div>
                        <div class="hero-section-wrap fl-wrap">
                            <div class="container">
                                <div class="home-intro">
                                    <div class="section-title-separator"><span></span></div>
                                    <h2>AirNSW</h2>
                                    <span class="section-separator"></span>                                    
                                </div>
                                <div class="main-search-input-wrap">
                                    <div class="main-search-input fl-wrap">
                                        <div class="main-search-input-item location" id="autocomplete-container">
                                            <span class="inpt_dec"><i class="fal fa-map-marker"></i></span>
                                            <input id="search-location" type="text" placeholder="City..." class="autocomplete-input" value=""/>
                                        </div>
                                        <div class="main-search-input-item main-date-parent main-search-input-item_small">
                                            <span class="inpt_dec"><i class="fal fa-calendar-check"></i></span> 
                                            <input id="search-date" type="text" placeholder="When" name="main-input-search"   value=""/>
                                        </div>
                                        <div class="main-search-input-item">
                                            <div class="qty-dropdown fl-wrap">
                                                <div class="qty-dropdown-header fl-wrap"><i class="fal fa-users"></i> Persons</div>
                                                <div class="qty-dropdown-content fl-wrap">
                                                    <div class="quantity-item">
                                                        <label><i class="fas fa-male"></i> Adults</label>
                                                        <div class="quantity">
                                                            <input id="search-adults-quantity" type="number" min="1" max="3" step="1" value="1">
                                                        </div>
                                                    </div>
                                                    <div class="quantity-item">
                                                        <label><i class="far fa-bed"></i> Rooms</label>
                                                        <div class="quantity">
                                                            <input id="search-rooms-quantity" type="number" min="1" max="3" step="1" value="1">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <button class="main-search-button color2-bg" id="search-button">Search <i class="fal fa-search"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="header-sec-link">
                            <div class="container"><a href="#sec2" class="custom-scroll-link color-bg"><i class="fal fa-angle-double-down"></i></a></div>
                        </div>
                    </section>
                    <!-- section end -->
                    <!--section -->
                    <section id="sec2">
                        <div class="container">
                            <div class="section-title">
                                <div class="section-title-separator"><span></span></div>
                                <h2>Recommended For You</h2>
                                <span class="section-separator"></span>
                            </div>
						 </div>
                         <!-- carousel -->
                        <div class="list-carousel fl-wrap card-listing ">
                            <!--listing-carousel-->
                            <div class="listing-carousel  fl-wrap ">
                                <!--slick-slide-item-->
                                {% for item in recommends %}
                                <div class="slick-slide-item">
                                    <!-- listing-item  -->
                                    <div class="listing-item">
                                        <article class="geodir-category-listing fl-wrap">
                                            <div class="geodir-category-img">
                                                <a href="../listing_single?acc_id={{item.id}}"><img src="{{ item.album_address }}" alt=""></a>
                                                <div class="geodir-category-opt">
                                                    <div class="listing-rating card-popup-rainingvis" data-starrating2="{{ item.avg_rating }}"></div>
                                                    <div class="rate-class-name">
                                                        <div class="score">{{ item.reviews_num }} Reviews </div>
                                                        <span>{{ item.avg_rating }}</span>                                             
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="geodir-category-content fl-wrap title-sin_item">
                                                <div class="geodir-category-content-title-item">
                                                    <h3 class="title-sin_map"><a href="../listing_single?acc_id={{item.id}}">{{ item.title }}</a></h3>
                                                </div>
                                                <div class="geodir-category-footer fl-wrap">
                                                    <div class="geodir-category-price">Price <span>$ {{item.price}}</span></div>
                                                </div>
                                            </div>
                                        </article>
                                    </div>
                                    <!-- listing-item end -->
                                </div>
                                {% endfor %}
                                <!--slick-slide-item end-->
                            </div>
                            <!--listing-carousel end-->
                            <div class="swiper-button-prev sw-btn"><i class="fa fa-long-arrow-left"></i></div>
                            <div class="swiper-button-next sw-btn"><i class="fa fa-long-arrow-right"></i></div>
                        </div>
                        <!--  carousel end-->
                    </section>
                    <!-- section end -->
                    <!-- section-->
                    <section class="grey-blue-bg">
                        <!-- container-->
                        <div class="container">
                            <div class="section-title">
                                <div class="section-title-separator"><span></span></div>
                                <h2>Top 20 Accommondations</h2>
                                <span class="section-separator"></span>
                            </div>
                        </div>
                        <!-- container end-->
                        <!-- carousel -->
                        <div class="list-carousel fl-wrap card-listing ">
                            <!--listing-carousel-->
                            <div class="listing-carousel  fl-wrap ">
                                <!--slick-slide-item-->
                                {% for item in topK %}
                                <div class="slick-slide-item">
                                    <!-- listing-item  -->
                                    <div class="listing-item">
                                        <article class="geodir-category-listing fl-wrap">
                                            <div class="geodir-category-img">
                                                <a href="../listing_single?acc_id={{item.id}}"><img src="{{ item.album_address }}" alt=""></a>
                                                <div class="geodir-category-opt">
                                                    <div class="listing-rating card-popup-rainingvis" data-starrating2="{{ item.avg_rating }}"></div>
                                                    <div class="rate-class-name">
                                                        <div class="score">{{ item.reviews_num }} Reviews </div>
                                                        <span>{{ item.avg_rating }}</span>                                             
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="geodir-category-content fl-wrap title-sin_item">
                                                <div class="geodir-category-content-title-item">
                                                    <h3 class="title-sin_map"><a href="../listing_single?acc_id={{item.id}}">{{ item.title }}</a></h3>
                                                </div>
                                                <div class="geodir-category-footer fl-wrap">
                                                    <div class="geodir-category-price">Price <span>$ {{item.price}}</span></div>
                                                    
                                                </div>
                                            </div>
                                        </article>
                                    </div>
                                    <!-- listing-item end -->
                                </div>
                                {% endfor %}
                                <!--slick-slide-item end-->
                            </div>
                            <!--listing-carousel end-->
                            <div class="swiper-button-prev sw-btn"><i class="fa fa-long-arrow-left"></i></div>
                            <div class="swiper-button-next sw-btn"><i class="fa fa-long-arrow-right"></i></div>
                        </div>
                        <!--  carousel end-->
                    </section>
                </div>
                <!-- content end-->
            </div>
            <!--wrapper end -->
            <!--footer -->
            <footer class="main-footer">
                {% include 'footer.html' %}
            </footer>
            <!--footer end -->          
            <!--register form -->
            {% include 'login-signup-logout-tags.html' %}
            <!--register form end -->
            <a class="to-top"><i class="fas fa-caret-up"></i></a>
        </div>

        <!-- Main end -->
        <!--=============== scripts  ===============-->
        <script type="text/javascript" src="../static/js/jquery.min.js"></script>
        <script type="text/javascript" src="../static/js/plugins.js"></script><!-- added -->
        <script type="text/javascript" src="../static/js/scripts_new.js"></script><!-- changed -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBL7eqcPUwBmkn80owGULmLmMVEZFr-iv4&libraries=places&callback=initAutocomplete"></script> 
        <script type="text/javascript" src="../static/js/map-single_new.js"></script><!-- changed -->
        <script type="text/javascript" src="../static/js/chatbot.js"></script>
        <!--=============== our scripts  ===============-->
        <script type="text/javascript">
            // Login
            $(document).on('submit', '#loginForm', function(){
                var username =  $("#uName").val(); 
                var password =  $("#uPass").val();
                $.post(
                    '{% url 'login' %}',  
                    // data
                    {
                        "username": username,
                        "password": password
                    },  
                    // callback
                    function(json){
                        //sessionStorage.setItem('username', username);
                        var status = json['status'];
                        if(status === "succeed"){
                            $("#posting-icon").show();
                            $("#request-icon").show();
                            $("a#user_protrait").text(username);
                            $("a#user_protrait").attr("href", "../user_profile?account_username="+json['username']);
                            $("#header_show_img").attr("src", json['show_img']);
                            $("#header_show_img").show();
                            $("#regist-box").hide();
                            $("#signin-icon").hide();
                            window.location.href ="../";
                        }else{
                            var msg = json['msg'];
                            $("#my-account").hide();
                            $("#login-message").text(msg);
                        }
                    },
                )
                return false;
            });
            // Signup
            $(document).on('submit', '#signupForm', function(){
                var username =  $("#signup_uName").val(); 
                var password =  $("#signup_uPass").val();
                var password2 =  $("#signup_uPass2").val();
                $.post(
                    '{% url 'signup' %}',  
                    // data
                    {
                        "username": username,
                        "password": password,
                        "password2": password2
                    },  
                    // callback
                    function(json){
                        var status = json['status'];
                        if(status === "succeed"){
                            $("#posting-icon").show();
                            $("#request-icon").show();
                            $("a#user_protrait").text(username);
                            $("a#user_protrait").attr("href", "../user_profile?account_username="+json['username']);
                            $("#header_show_img").attr("src", json['show_img']);
                            $("#header_show_img").show();
                            $("#regist-box").hide();
                            $("#signin-icon").hide();
                            window.location.href ="../";
                        }else{
                            var msg = json['msg'];
                            $("#my-account").hide();
                            $("#signup-message").text(msg);
                        }
                    },
                )
                return false;
            });
            // logout
            $(document).on('click', '#logout-link', function(){
                $.get(
                    '{% url 'logout' %}',  
                    // data
                    {},  
                    // callback
                    function(json){
                        $("#signin-icon").show();
                        $("#posting-icon").hide();
                        $("#request-icon").hide();
                        $("#header_show_img").hide();
                        $("#welcome").removeClass().addClass("header-user-name");
                        $("#welcome-list").removeClass();
                        $("a#user_protrait").text("My Account");
                        $("a#user_protrait").attr("href", "");
                        window.location.href ="../";
                    },
                )
            });

            // search 
            $(document).on('click', '#search-button', function(){
                var city =  $("#search-location").val();
                var date =  $("#search-date").val();
                var adults_quantity =  $("#search-adults-quantity").val();
                var rooms_quantity =  $("#search-rooms-quantity").val();
                data = {};
                $.get(
                    '',  
                    // data
                    {},  
                    // callback
                    function(json){
                        window.location.href ="../listing?city="+city+"&date="+date+"&adults_quantity="+adults_quantity+"&rooms_quantity="+rooms_quantity;
                    },
                )
            });
            // divid lat and lng from string
            function formalize_latlng(latlng_str){
                var latlng = latlng_str.replace("(","");
                latlng = latlng.replace(")","");
                latlng = latlng.replace(" ","");
                var latlng_list = latlng.split(",");
                var lat = parseFloat(latlng_list[0]);
                var lng = parseFloat(latlng_list[1]);
                return lat, lng;
            };
            // get address of the place by latitude and longtitude from google map
            function geocodePosition(pos){
                var geocoder;
                geocoder = new google.maps.Geocoder();
                geocoder.geocode({
                    latLng: pos
                }, function(responses){
                    if (responses && responses.length > 0) {
                        return responses[0].formatted_address;
                    } else {
                        return '';
                    }
                });
            }
            // mark the position of place on google map
            function singleMap(markerIcon) {
                var markerIcon = {
                    url: '../static/images/marker2.png',
                }
                var myLatLng = {
                    lng: $('#singleMap').data('longitude'),
                    lat: $('#singleMap').data('latitude'),
                };
                var single_map = new google.maps.Map(document.getElementById('singleMap'), {
                    zoom: 14,
                    center: myLatLng,
                    scrollwheel: false,
                    zoomControl: false,
                    fullscreenControl: true,
                    mapTypeControl: false,
                    scaleControl: false,
                    panControl: false,
                    navigationControl: false,
                    streetViewControl: true,
                    styles: [{
                        "featureType": "landscape",
                        "elementType": "all",
                        "stylers": [{
                            "color": "#f2f2f2"
                        }]
                    }]
                });
                var marker = new google.maps.Marker({
                    position: myLatLng,
                    map: single_map,
                    icon: markerIcon,
                    title: 'Location'
                });
                if ($(".controls-mapwn").length) {

                    var input = document.getElementById('pac-input');
                    var searchBox = new google.maps.places.SearchBox(input);

                    single_map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

                    single_map.addListener('bounds_changed', function () {
                        searchBox.setBounds(single_map.getBounds());
                    });
                    var markers = [];
                    searchBox.addListener('places_changed', function () {
                        var places = searchBox.getPlaces();

                        if (places.length == 0) {
                            return;
                        }
                        markers.forEach(function (marker) {
                            marker.setMap(null);
                        });
                        markers = [];
                        var bounds = new google.maps.LatLngBounds();
                        places.forEach(function (place) {
                            if (!place.geometry) {
                                console.log("Returned place contains no geometry");
                                return;
                            }
                            var icon = {
                                url: place.icon,
                                size: new google.maps.Size(71, 71),
                                origin: new google.maps.Point(0, 0),
                                anchor: new google.maps.Point(17, 34),
                                scaledSize: new google.maps.Size(25, 25)
                            };

                            // Create a marker for each place.
                            markers.push(new google.maps.Marker({
                                map: single_map,
                                icon: icon,
                                title: place.name,
                                position: place.geometry.location
                            }));

                            if (place.geometry.viewport) {
                                // Only geocodes have viewport.
                                bounds.union(place.geometry.viewport);
                            } else {
                                bounds.extend(place.geometry.location);
                            }
                        });
                        single_map.fitBounds(bounds);
                    });
                }
                var zoomControlDiv = document.createElement('div');
                var zoomControl = new ZoomControl(zoomControlDiv, single_map);
                function ZoomControl(controlDiv, single_map) {
                    zoomControlDiv.index = 1;
                    single_map.controls[google.maps.ControlPosition.RIGHT_CENTER].push(zoomControlDiv);
                    controlDiv.style.padding = '5px';
                    var controlWrapper = document.createElement('div');
                    controlDiv.appendChild(controlWrapper);
                    var zoomInButton = document.createElement('div');
                    zoomInButton.className = "mapzoom-in";
                    controlWrapper.appendChild(zoomInButton);
                    var zoomOutButton = document.createElement('div');
                    zoomOutButton.className = "mapzoom-out";
                    controlWrapper.appendChild(zoomOutButton);
                    google.maps.event.addDomListener(zoomInButton, 'click', function () {
                        single_map.setZoom(single_map.getZoom() + 1);
                    });
                    google.maps.event.addDomListener(zoomOutButton, 'click', function () {
                        single_map.setZoom(single_map.getZoom() - 1);
                    });
                }
                $(".single-map-item").on("click", function (e) {
                    e.preventDefault();
                    google.maps.event.trigger(single_map, 'resize');
                    $(".map-modal-wrap").fadeIn(400);
                    var $that = $(this),
                        newln = $that.data("newlatitude"),
                        newlg = $that.data("newlongitude"),
                        newtitle = $that.parents(".title-sin_item").find(".title-sin_map a").text(),
                        newurl = $that.parents(".title-sin_item").find(".title-sin_map a").attr('href');
                    var latlng = new google.maps.LatLng(newln, newlg);
                    marker.setPosition(latlng);
                    single_map.panTo(latlng);
                    $(".map-modal-container h3 a").text(newtitle).attr("href", newurl);
                });
                $(".map-modal-close , .map-modal-wrap-overlay").on("click", function (e) {
                    $(".map-modal-wrap").fadeOut(400);
                    single_map.setZoom(14);
                    single_map.getStreetView().setVisible(false);
                    $('#pac-input').val('');
                    markers.forEach(function (marker) {
                        marker.setMap(null);
                    });
                    markers = [];
                });
            }
            var single_map = document.getElementById('singleMap');
            if (typeof (single_map) != 'undefined' && single_map != null) {
                google.maps.event.addDomListener(window, 'load', singleMap());
            }
        </script>
           
    </body>
</html>
