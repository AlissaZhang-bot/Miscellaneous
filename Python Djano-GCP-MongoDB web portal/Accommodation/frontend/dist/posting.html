<!DOCTYPE HTML>
<html lang="en">
    <head>
        <title>AirNSW - Post</title>
        {% include 'head.html' %}
        <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css"> 
    </head>
    <body>
        <!--loader-->
        <div class="loader-wrap">
            <div class="pin">
                <div class="pulse"></div>
            </div>
        </div>
        <!--loader end-->
        <!-- Main  -->
        <div id="main">
            <!-- header-->
            <header class="main-header">
                {% include 'header.html' %}
            </header>
            <!--  header end -->
            <!--  wrapper  -->
            <div id="wrapper">
                <!-- content-->
                <div class="content">
                    <!-- section-->
                    <section class="flat-header color-bg adm-header" style="background-color: #c0b3a0;">
                        <div class="wave-bg wave-bg2"></div>
                        <div class="container">
                            <div class="dasboard-wrap fl-wrap">
                                <!--dasboard-sidebar-->
                                <div class="dasboard-sidebar">
                                {% include 'sidebar.html' %}
                                </div>
                                <!--dasboard-sidebar end--> 
                                <!-- dasboard-menu-->
                                <div class="dasboard-menu">
                                {% include 'dash_menu.html' %}
                                </div>
                                <!--dasboard-menu end-->
                            </div>
                        </div>
                    </section>
                    <!-- section end-->
                    <!-- section  -->
                    <section class="middle-padding">
                        <div class="container">
                            <!--dasboard-wrap-->
                            <div class="dasboard-wrap fl-wrap">
                                <!-- dashboard-content--> 
                                <div class="dashboard-content fl-wrap">
                                    <div class="box-widget-item-header">
                                        <h3> Basic Informations</h3>
                                    </div>
                                    <!-- profile-edit-container--> 
                                    <div class="profile-edit-container">
                                        <div class="custom-form">
                                            <label>Hotel Title <i class="fal fa-briefcase"></i></label>
                                            <span id="acc_id" style="display: none;">{{acc_id}}</span>
                                            <input id="title-of-home" type="text" placeholder="Title of your Hotel" value="{{acc_title}}"/>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label>Type / Category</label>
                                                    <div class="listsearch-input-item">
                                                        <select id="type-of-home" data-placeholder="Apartments" class="chosen-select no-search-select" >
                                                            <option></option>
                                                            {% if acc_type == 'Apartments' %}
                                                            <option selected = "selected">Apartments</option>
                                                            {% else %}
                                                            <option>Apartments</option>
                                                            {% endif %}

                                                            {% if acc_type == 'Hotel' %}
                                                            <option selected = "selected">Hotel</option>
                                                            {% else %}
                                                            <option>Hotel</option>
                                                            {% endif %}

                                                            {% if acc_type == 'House' %}
                                                            <option selected = "selected">House</option>
                                                            {% else %}
                                                            <option>House</option>
                                                            {% endif %}

                                                            {% if acc_type == 'Loft' %}
                                                            <option selected = "selected">Loft</option>
                                                            {% else %}
                                                            <option>Loft</option>
                                                            {% endif %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label>City / Location</label>
                                                    <div class="listsearch-input-item">
                                                        <select id="city-of-home" data-placeholder="City" class="chosen-select no-search-select" >
                                                            <option></option>
                                                            {% if city == 'Sydney' %}
                                                            <option selected = "selected">Sydney</option>
                                                            {% else %}
                                                            <option>Sydney</option>
                                                            {% endif %}

                                                            {% if city == 'Newcastle' %}
                                                            <option selected = "selected">Newcastle</option>
                                                            {% else %}
                                                            <option>Newcastle</option>
                                                            {% endif %}
                                                            
                                                            {% if city == 'Wollongong' %}
                                                            <option selected = "selected">Wollongong</option>
                                                            {% else %}
                                                            <option>Wollongong</option>
                                                            {% endif %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- profile-edit-container end--> 
                                    <div class="box-widget-item-header">
                                        <h3> Location </h3>
                                    </div>
                                    <!-- profile-edit-container--> 
                                    <div class="profile-edit-container">
                                        <div class="custom-form">
                                            <label>Address<i class="fal fa-map-marker"></i></label>
                                            <input id="address-of-home" type="text" placeholder="Address of your Hotel" value="{{ physical_address }}"/>
                                            
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <!-- <label>Longitude<i class="fal fa-long-arrow-alt-right"></i>  </label> -->
                                                    <input id="long-of-home" type="text" placeholder="Map Longitude"  id="long" value="{{long}}" class="hid-input"/>                                                
                                                </div>
                                                <div class="col-md-6">
                                                    <!-- <label>Latitude<i class="fal fa-long-arrow-alt-down"></i> </label> -->
                                                    <input id="lat-of-home" type="text" placeholder="Map Latitude"  id="lat" value="{{lat}}" class="hid-input"/>                                            
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- profile-edit-container end-->    
                                    <div class="box-widget-item-header mat-top">
                                        <h3>Upload Photos</h3>
                                    </div>
                                    <!-- profile-edit-container--> 
                                    <div class="profile-edit-container">
                                        <div class="custom-form">
                                            <div class="row">
                                                <!--col --> 
                                                <div class="col-md-4" style="width: 100%;">
                                                    <div class="add-list-media-wrap">
                                                        <div class="add-list-media-wrap" id="add-photo-div">
                                                            
                                                                <div class="fu-text" id = "show_img1">
                                                                    <span><i class="fal fa-image"></i> Please upload at least 3 photos of your properties. </span>
                                                                    <input id="img_upload" name="img" type="file" class="upload-img" style="margin-left:39%;"> 
                                                                    {% for item in albums %}
                                                                    <!-- < img src="{{item.url}}" name="show_img" id = "show_img"/> -->
                                                                    <div class="geodir-category-img" style="width: 260px; margin-right: 20px; padding: 10px;" id="img_{{item.id}}" name="show_img_div">
                                                                        <a><img src="{{item.url}}" id="a_{{item.id}}" name="show_img"></a>
                                                                        <a class="ed-btn" style="color: rgb(60, 115, 218);" id="{{item.id}}" >Delete</a>         
                                                                        <!--  -->   
                                                                    </div>
                                                                    {% endfor %}
                                                                </div>
                                                            <div id="app_form">

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--col end--> 
                                            </div>
                                        </div>
                                    </div>
                                    <!-- profile-edit-container end-->                                        
                                    <div class="box-widget-item-header mat-top">
                                        <h3>Details</h3>
                                    </div>
                                    <!-- profile-edit-container-->
                                    <div class="profile-edit-container">
                                    <div class="custom-form">
                                        <label>Price /Night<i class="fal fa-credit-card-front"></i>  </label>
                                        <input id="price-of-home" type="text" placeholder="" value="$ {{price}}"/>
                                        <label>Bedrooms Number<i class="far fa-home"></i>  </label>
                                        <input id="bedroom-number-of-home" type="text" placeholder="" value="{{bedrooms_num}}"/>
                                        <label>Bathrooms Number<i class="far fa-home"></i>  </label>
                                        <input id="bathroom-number-of-home" type="text" placeholder="" value="{{bathrooms_num}}"/>
                                        <label>Beds Number<i class="far fa-bed"></i>  </label>
                                        <input id="bed-number-of-home" type="text" placeholder="" value="{{beds_num}}"/>
                                        <label>Geusts Number<i class="far fa-bed"></i>  </label>
                                        <input id="geust-number-of-home" type="text" placeholder="" value="{{geust_num}}"/>
                                    </div>
                                    </div>
                                    <div class="profile-edit-container">
                                        <div class="custom-form">
                                            <label>Description</label>
                                            <textarea id="description-of-home" cols="40" rows="3" placeholder="Description">{{description}}</textarea> 
                                        </div>
                                    </div>
                                    <!-- profile-edit-container end-->                                       
                                    <!-- profile-edit-container end-->                                        
                                    <div class="box-widget-item-header mat-top">
                                        <h3>Facilities</h3>
                                    </div>
                                    <!-- profile-edit-container--> 
                                    <div class="profile-edit-container">
                                        <div class="custom-form">
                                            <!-- Checkboxes -->
                                            <ul class="fl-wrap filter-tags">
                                                <li>
                                                    {% if wifi %}
                                                    <input id="check-wifi" type="checkbox" name="check" checked>
                                                    {% else %}
                                                    <input id="check-wifi" type="checkbox" name="check">
                                                    {% endif %}
                                                    <label for="check-wifi">Free WiFi</label>
                                                </li>
                                                <li>
                                                    {% if parking %}
                                                    <input id="check-parking" type="checkbox" name="check" checked>
                                                    {% else %}
                                                    <input id="check-parking" type="checkbox" name="check">
                                                    {% endif %}
                                                    <label for="check-parking">Parking</label>
                                                </li>
                                                <li>   
                                                    {% if fitness %}
                                                    <input id="check-fitness" type="checkbox" name="check" checked>
                                                    {% else %}
                                                    <input id="check-fitness" type="checkbox" name="check">
                                                    {% endif %}                                    
                                                    <label for="check-fitness">Fitness</label>
                                                </li>
                                                <li>
                                                    {% if pool %}
                                                    <input id="check-pool" type="checkbox" name="check" checked>
                                                    {% else %}
                                                    <input id="check-pool" type="checkbox" name="check">
                                                    {% endif %}              
                                                    <label for="check-pool">Pool</label>
                                                </li>
                                                <li>  
                                                    {% if heating %}
                                                    <input id="check-heating" type="checkbox" name="check" checked>
                                                    {% else %}
                                                    <input id="check-heating" type="checkbox" name="check">
                                                    {% endif %}                                       
                                                    <label for="check-heating">Heating</label>
                                                </li>
                                                <li>      
                                                    {% if air_conditioning %}
                                                    <input id="check-air-Conditioning" type="checkbox" name="check" checked>
                                                    {% else %}
                                                    <input id="check-air-Conditioning" type="checkbox" name="check">
                                                    {% endif %}                                      
                                                    <label for="check-air-Conditioning">Air Conditioning</label>
                                                </li>
                                                <li>      
                                                    {% if hair_dryer %}
                                                    <input id="check-hair-dryer" type="checkbox" name="check" checked>
                                                    {% else %}
                                                    <input id="check-hair-dryer" type="checkbox" name="check">
                                                    {% endif %}                                      
                                                    <label for="check-hair-dryer">Hair Dryer</label>
                                                </li>
                                                <li>    
                                                    {% if tv %}
                                                    <input id="check-tv" type="checkbox" name="check" checked>
                                                    {% else %}
                                                    <input id="check-tv" type="checkbox" name="check">
                                                    {% endif %}                                        
                                                    <label for="check-tv">TV</label>
                                                </li>
                                            </ul>
                                            <!-- Checkboxes end -->
                                        </div>
                                    </div>
                                    <!-- profile-edit-container end-->
                                    <div class="profile-edit-container">
                                        <div class="custom-form">
                                            <button class="btn color2-bg float-btn" id="posting-button">Post</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- dashboard-list-box end--> 
                            </div>
                            <!-- dasboard-wrap end-->
                        </div>
                    </section>
                    <div class="limit-box fl-wrap"></div>
                </div>
                <!-- content end-->
            </div>
            <!--wrapper end -->
            <!--footer -->
            <footer class="main-footer">
                {% include 'footer.html' %}

            </footer>
            <!--footer end -->          
            <!--register form -->
            {% include 'login-signup-logout-tags.html' %}
            <!--register form end -->
            <a class="to-top"><i class="fas fa-caret-up"></i></a>
        </div>
        <!-- Main end -->
        <!--=============== scripts  ===============-->
        <script type="text/javascript" src="../static/js/jquery.min.js"></script>
        <script type="text/javascript" src="../static/js/plugins.js"></script>
        <script type="text/javascript" src="../static/js/scripts_new.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBL7eqcPUwBmkn80owGULmLmMVEZFr-iv4&libraries=places&callback=initAutocomplete"></script>
        <script type="text/javascript">
            // dynamic change position on map
            $("#address-of-home").change(function(){
                var geocoder = new google.maps.Geocoder();
                geocoder.geocode({ 'address':  $("#address-of-home").val()},geo);
            });
            function geo(results, status){
                if (status == google.maps.GeocoderStatus.OK) {
                    console.log(results[0].geometry.location.lat());
                    var lng_input = document.getElementById('long-of-home');
                    lng_input.setAttribute('value', results[0].geometry.location.lng());
                    var lat_input = document.getElementById('lat-of-home');
                    lat_input.setAttribute('value', results[0].geometry.location.lat());
                    //alert("Get the place position!");
                } else{
                    alert("Sorry, cannot locate your position.");
                }
            }

            // get address of the place by latitude and longtitude from google map
            function geocodePosition(pos){
                var geocoder;
                geocoder = new google.maps.Geocoder();
                geocoder.geocode({
                    latLng: pos
                }, function(responses){
                    if (responses && responses.length > 0) {
                        $('#address-of-home').val(responses[0].formatted_address);
                    } else {
                        $('#address-of-home').val(''); 
                    }
                });
            }
            $(window).load(
                function(){
                    var lng = $('#long-of-home').val();
                    var lat = $("#lat-of-home").val()
                    var address = $('#address-of-home').val();
                    if (lng != "" && lat != "" && address == ""){
                        lng = parseFloat(lng);
                        lat = parseFloat(lat);
                        geocodePosition(new google.maps.LatLng(lat, lng));
                    }
                }
            );

            // delete image
            var img_list = new Array();
            $(function(){
                $("div#show_img1").find("[id]").each(function(){  
                    var id = $(this).attr("id");  
                    img_list.push(id);
                });
                console.log(img_list);
                img_list.forEach((item,index,array)=>{
                    $(document).on('click', '#'+item, function(){
                        console.log(item);
                        img_name = "img_"+item;
                        a_name = "a_"+item;
                        
                        var div = document.getElementById(img_name);
                        $('#'+img_name).hide();
                        
                        var acc_id = document.getElementById('acc_id').innerHTML;
                        
                        var url = document.getElementById(a_name).src;
                        //alert(acc_id);
                        //alert(url);
                        $.post(
                            '{% url 'delete_photo' %}',  
                            // data
                            {
                                "img": url,
                                "acc_id": acc_id
                            }, 
                            function(){
                                document.getElementById('show_img1').removeChild(div);
                            }
                        )
                        return false;
                    });
                })
            });
            $(document).on('click', '#posting-button', function(){
                //alert('post');
                if(document.getElementById('acc_id') != null){
                    var acc_id = document.getElementById('acc_id').innerHTML;
                    //alert(acc_id);
                } else {
                    var acc_id = '';
                }
                var title =  $("#title-of-home").val(); 
                if(title === ""){
                    alert('Title can not be empty.');
                    return false;
                }
                var type =  $("#type-of-home").val();
                if(type === ""){
                    alert('Please choose a type of your properties.');
                    return false;
                }
                var city =  $("#city-of-home").val();
                if(city === ""){
                    alert('Please choose the city of your properties.');
                    return false;
                }
                var address =  $("#address-of-home").val();
                if(address === ""){
                    alert('Address can not be empty.');
                    return false;
                }

                var img_elements = document.getElementsByName('show_img');
                var imgs = new Array();
                if(img_elements.length < 3){
                    alert('Please add at least 3 photos of your accommodation.');
                    return false;
                }
                img_elements.forEach(element => {
                    imgs.push(element.src);
                });
                var imgs_json_str = JSON.stringify(imgs).toString();
                //alert(address);
                var long =  $("#long-of-home").val();
                var lat =  $("#lat-of-home").val();
                
                var description =  $("#description-of-home").val();
                var price = $("#price-of-home").val();
                if(price === ""){
                    alert('Price can not be empty.');
                    return false;
                }
                var bedroom =  $("#bedroom-number-of-home").val();
                if(bedroom === ""){
                    alert('Bedrooms can not be empty.');
                    return false;
                }
                var bathroom =  $("#bathroom-number-of-home").val();
                if(bathroom === ""){
                    alert('Bathrooms can not be empty.');
                    return false;
                }
                var bed =  $("#bed-number-of-home").val();
                if(bed === ""){
                    alert('Beds can not be empty.');
                    return false;
                }
                var geust =  $("#geust-number-of-home").val();
                if(geust === ""){
                    alert('Geusts can not be empty.');
                    return false;
                }
                /* alert(price); */
                // amenity
                var isWifiChecked = $('#check-wifi').prop('checked');
                var isParkingChecked = $('#check-parking').prop('checked');
                var isFitnessChecked = $('#check-fitness').prop('checked');
                var isPoolChecked = $('#check-pool').prop('checked');
                var isHeatingChecked = $('#check-heating').prop('checked');
                var isAirConditioningChecked = $('#check-air-Conditioning').prop('checked');
                var isHairDryerChecked = $('#check-hair-Dryer').prop('checked');
                var isTvChecked = $('#check-tv').prop('checked');
                
                //alert(isTvChecked);
                
                // share space
                $.post(
                    '{% url 'posting' %}',  
                    // data
                    {
                        "acc_id": acc_id,
                        "title": title,
                        "type": type,
                        "address": address,
                        "long": long,
                        "lat": lat,
                        "city": city,
                        "description": description,
                        "price": price,
                        "bedroom": bedroom,
                        "bed": bed,
                        "geust": geust,
                        "bathroom": bathroom,
                        "wifi": isWifiChecked,
                        "parking": isParkingChecked,
                        "fitness": isFitnessChecked,
                        "pool": isPoolChecked,
                        "heating": isHeatingChecked,
                        "air_conditioning": isAirConditioningChecked,
                        "hair_dryer": isHairDryerChecked,
                        "tv": isTvChecked,
                        "imgs": imgs_json_str
                    },  
                    // callback
                    function(json){
                        var status = json['status'];
                        if(status === "succeed"){
                            //window.location.href ="";
                            //alert('succeed');
                            console.log("post succeed");
                            window.location.href ="../user_listings";
                        } else {
                            alert('You have not written anything.');
                            console.log("post failed");
                        }
                    },
                )
                return false;
            });
            // upload_photo
            $('#img_upload').change(function(){
                var fileDom = document.getElementById('img_upload');
                var app_form = document.getElementById('show_img1');
                //alert(document.getElementById('acc_id').innerHTML);
                if(document.getElementById('acc_id') != null){
                    var acc_id = document.getElementById('acc_id').innerHTML;
                } else {
                    var acc_id = '';
                }
                var file = fileDom.files[0];
                var reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function(e)
                {$.post(
                    "{% url 'upload_photo' %}",  
                    // data
                    {
                        "img": reader.result,
                        "acc_id": acc_id,
                    },  
                    // callback
                    function(json){
                        //let el = document.getElementsByTagName('img');
                        //console.log(el.length);
                        var acc = document.getElementById('acc_id');
                        var img_show = document.createElement('img');
                        img_show.setAttribute('src', json['img_url']);
                        img_show.setAttribute('name', 'show_img');
                        //img_show.id = "img"+el.length.toString();
                        var div = document.createElement('div');
                        div.setAttribute('class', 'geodir-category-img');
                        div.style.width = '260px';
                        div.style.marginRight = '20px';
                        div.style.padding = '10px';
                        var a = document.createElement('a');
                        a.appendChild(img_show);
                        div.appendChild(a);
                        var a2 = document.createElement('a');
                        a2.setAttribute('class', 'ed-btn');
                        a2.style.color = 'rgb(60, 115, 218)';
                        a2.innerHTML = 'Delete';
                        a2.addEventListener('click', function(){
                            div.style.display='None';
                            $.post(
                                "{% url 'delete_photo' %}",
                                {
                                    "img" : img_show.src,
                                    "acc_id" : acc_id,
                                },
                                function(){
                                    app_form.removeChild(div);
                                }
                            )
                        });
                        div.appendChild(a2);
                        app_form.appendChild(div);

                        acc.innerHTML = json['acc_id'];
                        //alert(acc.innerHTML);
                    },
                )}
                return false;
            });
            // Login
            $(document).on('submit', '#loginForm', function(){
                var username =  $("#uName").val(); 
                var password =  $("#uPass").val();
                $.post(
                    '{% url 'login' %}',  
                    // data
                    {
                        "username": username,
                        "password": password
                    },  
                    // callback
                    function(json){
                        //sessionStorage.setItem('username', username);
                        var status = json['status'];
                        if(status === "succeed"){
                            $("#posting-icon").show();
                            $("#request-icon").show();
                            $("a#user_protrait").text(username);
                            $("a#user_protrait").attr("href", "../user_profile?account_username="+json['username']);
                            $("#header_show_img").attr("src", json['show_img']);
                            $("#header_show_img").show();
                            $("#regist-box").hide();
                            $("#signin-icon").hide();
                        }else{
                            var msg = json['msg'];
                            $("#my-account").hide();
                            $("#login-message").text(msg);
                        }
                    },
                )
                return false;
            });
            // Signup
            $(document).on('submit', '#signupForm', function(){
                var username =  $("#signup_uName").val(); 
                var password =  $("#signup_uPass").val();
                var password2 =  $("#signup_uPass2").val();
                $.post(
                    '{% url 'signup' %}',  
                    // data
                    {
                        "username": username,
                        "password": password,
                        "password2": password2
                    },  
                    // callback
                    function(json){
                        var status = json['status'];
                        if(status === "succeed"){
                            $("#posting-icon").show();
                            $("#request-icon").show();
                            $("a#user_protrait").text(username);
                            $("a#user_protrait").attr("href", "../user_profile?account_username="+json['username']);
                            $("#header_show_img").attr("src", json['show_img']);
                            $("#header_show_img").show();
                            $("#regist-box").hide();
                            $("#signin-icon").hide();
                        }else{
                            var msg = json['msg'];
                            $("#my-account").hide();
                            $("#signup-message").text(msg);
                        }
                    },
                )
                return false;
            });
            // logout
            $(document).on('click', '#logout-link', function(){
                $.get(
                    '{% url 'logout' %}',  
                    // data
                    {},  
                    // callback
                    function(json){
                        window.location.href ="../";
                    },
                )
            });
            
        </script>   
    </body>
</html>


