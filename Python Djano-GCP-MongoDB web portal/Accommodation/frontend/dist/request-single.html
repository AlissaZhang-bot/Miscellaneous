<!DOCTYPE HTML>
<html lang="en">
    <head>
        <title>AirNSW - List</title>
        {% include 'head.html' %}
        <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">  
    </head>
    <body>
        <!--loader-->
        <div class="loader-wrap">
            <div class="pin">
                <div class="pulse"></div>
            </div>
        </div>
        <!--loader end-->
        <!-- Main  -->
        <div id="main">
            <!-- header-->
            <header class="main-header">
               {% include 'header.html' %}
            </header>
            <!--  header end -->
            <!--  wrapper  -->
            <div id="wrapper">
                <!-- content-->
                <div class="content">
                    <!--  section  -->
                        <div class="list-single-hero-title fl-wrap">
                            <div class="container">
                                <div class="row">
                                    <div class="col-md-7">
                                        <h2><span>{{ ret.title }}</span></h2>
                                    </div>
                                    <div class="col-md-5">
                                        <!--  list-single-hero-details-->
                                        <div class="list-single-hero-details fl-wrap">
                                            <!--  list-single-hero-rating-->
                                            <div class="list-single-hero-rating">
                                                <div class="rate-class-name">
                                                    <div class="score"><strong> </strong>{{ reviews_count }} Feedback(s) </div>
                                                </div>
                                            </div>
                                            <div class="clearfix"></div>                                           
                                        </div>
                                        <!--  list-single-hero-details  end-->
                                    </div>
                                </div>
                            </div>
                        </div>
                    <!--  section  end-->
                    <!--  section  -->
                    <section class="grey-blue-bg small-padding scroll-nav-container" id="sec2">
                        <!--  scroll-nav-wrapper  -->
                        <div class="scroll-nav-wrapper fl-wrap">
                            
                            <div class="clearfix"></div>
                            <div class="container">
                                <nav class="scroll-nav scroll-init">
                                    <ul>
                                        <li><a class="act-scrlink" href="#sec1">Top</a></li>
                                        <li><a href="#sec3">Demands</a></li>
                                        <li><a href="#sec5">Feedbacks</a></li>
                                    </ul>
                                </nav>
                                <!-- <a href="#" class="show-hidden-map">  <span>On The Map</span> <i class="fal fa-map-marked-alt"></i></a> -->
                            </div>
                        </div>
                        <!--  scroll-nav-wrapper end  -->                    
                        <!--   container  -->
                        <div class="container">
                            <!--   row  -->
                            <div class="row">
                                <!--   datails -->
                                <div class="col-md-8">
                                    <div class="list-single-main-container ">
                                        <!-- fixed-scroll-column  -->
                                        <div class="fixed-scroll-column">
                                            <div class="fixed-scroll-column-item fl-wrap">
                                                <div class="showshare sfcs fc-button"><i class="far fa-share-alt"></i><span>Share </span></div>
                                                <div class="share-holder fixed-scroll-column-share-container">
                                                    <div class="share-container  isShare"></div>
                                                </div>
                                                <a class="fc-button custom-scroll-link" href="#sec6"><i class="far fa-comment-alt-check"></i> <span>  Add Feedback </span></a>
                                                <!-- <a class="fc-button" href="#"><i class="far fa-heart"></i> <span>Save</span></a> -->
                                            </div>
                                        </div>
                                        <!-- fixed-scroll-column end   -->
                                        <div class="list-single-main-media fl-wrap">
                                            <!-- gallery-items   -->
                                            <div class="gallery-items grid-small-pad  list-single-gallery three-coulms lightgallery">
                                                
                                            </div>
                                            <!-- end gallery items -->                                          
                                        </div>
                                        <!-- list-single-header end -->
                                        <!--   list-single-main-item -->
                                        <div class="list-single-main-item fl-wrap">
                                            <div class="list-single-main-item-title fl-wrap">
                                                <h3>About this request </h3>
                                            </div>
                                            <p>{{ ret.description }}</p>
                                        </div>
                                        <!--   list-single-main-item end -->
                                        <!--   list-single-main-item -->
                                        <div class="list-single-main-item fl-wrap" id="sec3">
                                            <div class="list-single-main-item-title fl-wrap">
                                                <h3>Demands</h3>
                                            </div>
                                            <div class="listing-features fl-wrap">
                                                <ul>
                                                    <li><i class="fal fa-map-marker"></i> {{ret.city}}</li>
                                                    <li><i class="fal fa-home"></i> {{ret.property_type}}</li>
                                                    <li><i class="far fa-home"></i> {{ret.bathrooms_num}} Bathroom(s)</li>
                                                    <li><i class="far fa-home"></i> {{ret.bedrooms_num}} Bedroom(s)</li>
                                                    <li><i class="far fa-bed"></i> {{ret.guests_num}} Guest(s)</li>
                                                    <li><i class="far fa-bed"></i> {{ret.beds_num}} Bed(s)</li>
                                                    {% if ret.tv != 'False' %}
                                                        <li><i class="fal fa-rocket"></i>TV</li>
                                                    {% endif %}
                                                    {% if ret.air_conditioning %}
                                                        <li><i class="fal fa-snowflake"></i> Air Conditioned</li>
                                                    {% endif %}
                                                    {% if ret.wifi %}
                                                        <li><i class="fal fa-wifi"></i> Free Wi Fi</li>
                                                    {% endif %}
                                                    {% if ret.kitchen %}
                                                        <li><i class="fal fa-utensils"></i> Kitchen</li>
                                                    {% endif %}
                                                    {% if ret.washing_machine %}
                                                        <li><i class="fal fa-cabinet-filing"></i> Washing Machine</li>
                                                    {% endif %}
                                                    {% if ret.parking %}
                                                        <li><i class="fal fa-parking"></i> Parking</li>
                                                    {% endif %}
                                                    {% if ret.gym %}
                                                        <li><i class="fal fa-dumbbell"></i> Gym</li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                            
                                        </div>
                                        <!--   list-single-main-item end --> 
                                        <!-- list-single-main-item -->   
                                        <div class="list-single-main-item fl-wrap" id="sec5">
                                            <div class="list-single-main-item-title fl-wrap">
                                                <h3>Feedbacks </h3>
                                            </div>
                                            <!--reviews-score-wrap-->   
                                            <div class="reviews-score-wrap fl-wrap">
                                                <div class="review-score-total">
                                                    <a href="#sec6" class="color2-bg">Add Feedback</a>
                                                </div>
                                                <div class="review-score-detail">
                                                    <!-- review-score-detail-list-->
                                                    <div class="review-score-detail-list">
                                                    </div>
                                                    <!-- review-score-detail-list end-->
                                                </div>
                                            </div>
                                            <!-- reviews-score-wrap end -->   
                                            <span id="store_request_id" style="display: none;">{{ret.id}}</span>

                                            <div class="reviews-comments-wrap">
                                                <!-- reviews-comments-item -->
                                                {% for review in reviews %}  
                                                <div class="reviews-comments-item">
                                                    <div class="review-comments-avatar">
                                                        <img src="{{review.request_owner_id.portrait_address}}" alt=""> 
                                                    </div>
                                                    <div class="reviews-comments-item-text">
                                                        <h4><a href="../user_profile?account_username={{review.reply_id.username}}" id="{{review.id}}_name">{{ review.reply_name }}</a></h4>
                                                        <div class="clearfix"></div>
                                                        <p>{{ review.comments }}</p>
                                                        <div id="all_reviews" class="reviews-comments-item-date">
                                                            <span><i class="far fa-calendar-check"></i>{{ review.request_time }}</span>
                                                            <a id="show-comment_{{review.id}}"><i class="fal fa-comments"></i> Show</a>
                                                            <a id="show-reply_{{review.id}}" style="margin-right: 10px;"><i class="fal fa-reply"></i> Reply</a>
                                                        </div>
                                                        <div id="all_replies">
                                                        <form role="form" id="show-reply_{{review.id}}_box" style="display: none;">
                                                            <div class="form-group">
                                                                <label for="name">Reply to {{ review.reply_name }}</label>
                                                                <textarea class="form-control" rows="3" name="{{review.id}}_textarea" value=""></textarea>
                                                            </div>
                                                            <button type="submit" class="btn btn-primary">Post</button>
                                                        </form></div>

                                                        <div id="all-single-replies" name="{{review.id}}_forms">
                                                            {% for comm in rw_comments %}
                                                                {% ifequal comm.rq_review_id.id review.id %}
                                                                <form role="form" id="show-single-reply_{{comm.id}}_box" style="display: none;">
                                                                    <div class="form-group">
                                                                        <label for="name">Comment to {{comm.username.name}}</label>
                                                                        <textarea class="form-control" rows="3" name="{{comm.id}}_inner_textarea" value=""></textarea>
                                                                    </div>
                                                                    <button type="submit" class="btn btn-primary">Post</button>
                                                                </form>
                                                                {% endifequal %}
                                                            {% endfor %}
                                                        </div>
                                                        <div id="show-comment_{{review.id}}_box" style="display: none;">
                                                            {% for comm in rw_comments %}
                                                                {% ifequal comm.rq_review_id.id review.id %}
                                                                    <!-- <span id="get_rely_name" style="display: none;">{{comm.username.name}}</span> -->
                                                                    <p style="padding-bottom:0px; margin: 0px;"><a href="../user_profile?account_username={{comm.username.id}}" id="{{comment_id}}_name">{{comm.username.name}}</a> @ <a href="../user_profile?account_username={{comm.reply_to.username}}">{{ comm.reply_to.username }}</a>     {{comm.comment_time}}     <a id="show-single-reply_{{comm.id}}"><i class="fal fa-reply"></i> reply</a></p>
                                                                    <p style="padding-bottom:0px;"><comm class="content">{{comm.content}}</comm></p>
                                                                    
                                                                    {% endifequal %}
                                                            {% endfor %}    
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                                <!--reviews-comments-item end-->                                                                 
                                            </div>
                                        </div>
                                        <!-- list-single-main-item end -->   
                                        <!-- list-single-main-item -->   
                                        <div class="list-single-main-item fl-wrap" id="sec6">
                                            <div class="list-single-main-item-title fl-wrap">
                                                <h3>Add Feeback</h3>
                                            </div>
                                            <!-- Add Review Box -->
                                            <div id="add-review" class="add-review-box">
                                                <!-- Review Comment -->
                                                <form id="add-comment" class="add-comment  custom-form" name="rangeCalc" >
                                                    <textarea id="feedback_text" cols="40" rows="3" placeholder="Your Feedback:"></textarea>
                                                    <button id="add_feedback_button" class="btn  big-btn flat-btn float-btn color2-bg" style="margin-top:30px">Submit Feedback </button>
                                                </form>
                                            </div>
                                            <!-- Add Review Box / End -->
                                        </div>
                                        <!-- list-single-main-item end -->                                    
                                    </div>
                                </div>
                                <!--   datails end  -->
                                <!--   sidebar  -->
                                <div class="col-md-4">
                                    <!--box-widget-wrap -->  
                                    <div class="box-widget-wrap">                                   
                                        <!--box-widget-item -->
                                        <div class="box-widget-item fl-wrap">
                                            <div class="box-widget">
                                                <div class="box-widget-content">
                                                    <div class="box-widget-item-header">
                                                        <h3> Contact Information</h3>
                                                    </div>
                                                    <div class="box-widget-list">
                                                        <ul>
                                                            <li><span><i class="fal fa-envelope"></i> Mail :</span> {{ret.owner_id.email}}</li>
                                                            <li><span><i class="fal fa-browser"></i> Website :</span> {{ret.owner_id.url}}</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--box-widget-item end -->                          
                                        <!--box-widget-item -->
                                        <div class="box-widget-item fl-wrap">
                                            <div class="box-widget">
                                                <div class="box-widget-content">
                                                    <div class="box-widget-item-header">
                                                        <h3> Price Range </h3>
                                                    </div>
                                                    <div class="claim-price-wdget fl-wrap">
                                                        <div class="claim-price-wdget-content fl-wrap">
                                                            <div class="pricerange fl-wrap"><span>Price : </span> {{ret.price}} </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--box-widget-item end -->                             
                                        <!--box-widget-item -->
                                        <div class="box-widget-item fl-wrap">
                                            <div class="box-widget">
                                                <div class="box-widget-content">
                                                    <div class="box-widget-item-header">
                                                        <h3>Requested By</h3>
                                                    </div>
                                                    <div class="box-widget-author fl-wrap">
                                                        <div class="box-widget-author-title fl-wrap">
                                                            <div class="box-widget-author-title-img">
                                                                <img src="{{ret.owner_id.portrait_address}}" alt=""> 
                                                            </div>
                                                            <a href="../user_profile?account_username={{ret.owner_id.username}}">{{ret.owner_id.username}}</a>
                                                            
                                                        </div>
                                                        <a href="../user_profile?account_username={{ret.owner_id.username}}" class="btn flat-btn color-bg   float-btn">View Profile</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--box-widget-item end -->                              
                                        <!--box-widget-item -->
                                        
                                        <!--box-widget-item end -->                            
                                    </div>
                                    <!--box-widget-wrap end -->  
                                </div>
                                <!--   sidebar end  -->
                            </div>
                            <!--   row end  -->
                        </div>
                        <!--   container  end  -->
                    </section>
                    <!--  section  end-->
                </div>
                <!-- content end-->
                <div class="limit-box fl-wrap"></div>
            </div>
            <!--wrapper end -->
            <!--footer -->
            <footer class="main-footer">
                {% include 'footer.html' %}
            </footer>
            <!--footer end -->          
            <!--register form -->
            {% include 'login-signup-logout-tags.html' %}
            <!--register form end -->
            <a class="to-top"><i class="fas fa-caret-up"></i></a>
        </div>
        <!-- Main end -->
        <!--=============== scripts  ===============-->
        <script type="text/javascript" src="../static/js/jquery.min.js"></script>
        <script type="text/javascript" src="../static/js/plugins.js"></script>
        <script type="text/javascript" src="../static/js/scripts_new.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBL7eqcPUwBmkn80owGULmLmMVEZFr-iv4&libraries=places&callback=initAutocomplete"></script> 
        <script type="text/javascript" src="../static/js/map-single_new.js"></script>
        <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!--=============== our scripts  ===============-->
        <script type="text/javascript">
            $( window ).load(function() {
                $('#dash_profile').removeClass("user-profile-act");
                $('#dash_listing').removeClass("user-profile-act");
                $('#dash_review').removeClass("user-profile-act");
                $('#dash_booking').removeClass("user-profile-act");
                $('#dash_request').addClass("user-profile-act");
            });

            // show reply box
            var review_list = new Array();
            $(function(){
                $("div#all_reviews").find("[id]").each(function(){  
                    var id = $(this).attr("id");  
                    review_list.push(id);
                })
                review_list.forEach((item,index,array)=>{
                    $(document).on('click', '#'+item, function(){
                        var box_name = item+'_box';
                        console.log(box_name);
                        $('#'+box_name).toggle();

                        var single_review_list = new Array();
                        $("div#"+box_name).find("[id]").each(function(){  
                            var single_id = $(this).attr("id");  
                            single_review_list.push(single_id);
                        })
                        //console.log(single_review_list);
                        single_review_list.forEach((item1,index1,array1)=>{
                            $(document).on('click', '#'+item1, function(){
                                var single_box_name = item1+'_box';
                                console.log("single reply",single_box_name);
                                $('#'+single_box_name).toggle();
                            });
                        });
                    });
                })
            });

            // post reply content
            var review_list = new Array();
            $(function(){
                $("div#all_replies").find("[id]").each(function(){  
                    var id = $(this).attr("id");  
                    review_list.push(id);
                })
                review_list.forEach((item,index,array)=>{
                    $(document).on('submit', '#'+item, function(){
                        var review_id = item.split("_")[1];
                        var textarea_value = review_id + "_textarea";
                        console.log(review_id);
                        console.log(textarea_value);
                        var reply = $('[name ='+textarea_value+']').val();
                        console.log(reply);
                        //alert(review_id, reply);
                        if(reply.replace(/\s/g, "").length ==0){
                            alert("Content cannot be empty.");
                            return false;
                        }
                        $('#'+item).toggle();
                        $.post(
                            '{% url 'reply_to_feedbacks' %}',  
                            // data
                            {
                                "feedback_id": review_id,
                                "textarea_value": reply
                            },  
                            function(json){
                                var status = json['status']; 
                                if(status == '200'){
                                    var new_rw_id = json['new_rw_id'];
                                    var new_rw_rp_id = json['new_rw_rp_id'];
                                    var new_rw_rp_name = json['new_rw_rp_name'];
                                    var new_rw_user = json['new_rw_user'];
                                    var new_cm_time = json['new_cm_time'];
                                    var rq_review_id = json['rq_review_id'];
                                    new_cm_time = new_cm_time.split('.')[0];
                                    new_cm_time = new_cm_time.replace("T", " ");
                                    
                                    var parent = $('#show-comment_'+review_id+'_box');
                                    parent.prepend('<p style="padding-bottom:0px;"><comm class="content">'+reply+'</comm></p>')
                                    parent.prepend('<p style="padding-bottom:0px; margin: 0px;"><a href="../user_profile?account_username={{request.session.username}}">'+new_rw_user+'</a> @ <a href="../user_profile?account_username='+new_rw_rp_id+'">'+new_rw_rp_name+'</a>     '+new_cm_time+'</p>')
                                } else {
                                    alert("Please Login first.");
                                    $('#regist-box').show();
                                }
                            }
                        )
                        return false;
                    });
                })
            });

            // post single reply
            var single_reply_list = new Array();
            $(function(){
                $("div#all-single-replies").find("[id]").each(function(){  
                    var id = $(this).attr("id");  
                    single_reply_list.push(id);
                })
                single_reply_list.forEach((item,index,array)=>{
                    $(document).on('submit', '#'+item, function(){
                        var comment_id = item.split("_")[1];
                        var textarea_value = comment_id + "_inner_textarea";
                        console.log(comment_id);
                        console.log(textarea_value);
                        var reply = $('[name ='+textarea_value+']').val();
                        console.log(reply);
                        //alert(comment_id, reply);
                        if(reply.replace(/\s/g, "").length ==0){
                            alert("Content cannot be empty.");
                            return false;
                        }
                        $('#'+item).toggle();
                        $.post(
                            '{% url 'reply_reply_request' %}',  
                            // data
                            {
                                "comment_id": comment_id,
                                "textarea_value": reply
                            },  
                            // callback
                            function(json){
                                var status = json['status']; 
                                if(status == '200'){
                                    var new_rw_id = json['new_rw_id'];
                                    var new_rw_rp_id = json['new_rw_rp_id'];
                                    var new_rw_rp_name = json['new_rw_rp_name'];
                                    var new_rw_user = json['new_rw_user'];
                                    var new_cm_time = json['new_cm_time'];
                                    var rq_review_id = json['rq_review_id'];
                                    new_cm_time = new_cm_time.split('.')[0];
                                    new_cm_time = new_cm_time.replace("T", " ");
                                    var parent = $('#show-comment_'+rq_review_id+'_box');
                                    parent.prepend('<p style="padding-bottom:0px;"><comm class="content">'+reply+'</comm></p>')
                                    parent.prepend('<p style="padding-bottom:0px; margin: 0px;"><a href="../user_profile?account_username={{request.session.username}}">'+new_rw_user+'</a> @ <a href="../user_profile?account_username='+new_rw_rp_id+'">'+new_rw_rp_name+'</a>     '+new_cm_time+'</p>')
                                } else {
                                    alert("Please Login first.");
                                    $('#regist-box').show();
                                }
                            }
                        )
                        return false;
                    });
                })
            });

            // add feedbacks
            $(document).on('click', '#add_feedback_button', function(){
                var my_feedback = $('#feedback_text').val();
                var request_id = document.getElementById('store_request_id').innerHTML;
                console.log(my_feedback);
                console.log(typeof(request_id))
                console.log("../request_single?request_id="+request_id);
                //alert("../request_single?request_id="+request_id);
                        
                if(my_feedback.replace(/\s/g, "").length ==0){
                    alert("Feedback cannot be empty.");
                    return false;
                }
                $.post(
                    '{% url 'add_feedbacks' ret.id %}',  
                    // data
                    {
                        "my_feedback": my_feedback
                    },  
                    function(json){
                        var status = json['status'];
                        if(status == '200'){
                            window.location.href ="../request_single/?request_id="+request_id;
                        } else {
                            alert("Please Login first.");
                            $('#regist-box').show();
                        }
                    }
                )
                return false;
            })

            // Login
            $(document).on('submit', '#loginForm', function(){
                var username =  $("#uName").val(); 
                var password =  $("#uPass").val();
                $.post(
                    '{% url 'login' %}',  
                    // data
                    {
                        "username": username,
                        "password": password
                    },  
                    // callback
                    function(json){
                        var status = json['status'];
                        if(status === "succeed"){
                            $("#posting-icon").show();
                            $("#request-icon").show();
                            $("a#user_protrait").text(username);
                            $("a#user_protrait").attr("href", "../user_profile?account_username="+json['username']);
                            $("#header_show_img").attr("src", json['show_img']);
                            $("#header_show_img").show();
                            $("#regist-box").hide();
                            $("#signin-icon").hide();
                        }else{
                            var msg = json['msg'];
                            $("#my-account").hide();
                            $("#login-message").text(msg);
                        }
                    },
                )
                return false;
            });
            // Signup
            $(document).on('submit', '#signupForm', function(){
                var username =  $("#signup_uName").val(); 
                var password =  $("#signup_uPass").val();
                var password2 =  $("#signup_uPass2").val();
                $.post(
                    '{% url 'signup' %}',  
                    // data
                    {
                        "username": username,
                        "password": password,
                        "password2": password2
                    },  
                    // callback
                    function(json){
                        var status = json['status'];
                        if(status === "succeed"){
                            $("#posting-icon").show();
                            $("#request-icon").show();
                            $("a#user_protrait").text(username);
                            $("a#user_protrait").attr("href", "../user_profile?account_username="+json['username']);
                            $("#header_show_img").attr("src", json['show_img']);
                            $("#header_show_img").show();
                            $("#regist-box").hide();
                            $("#signin-icon").hide();
                        }else{
                            var msg = json['msg'];
                            $("#my-account").hide();
                            $("#signup-message").text(msg);
                        }
                    },
                )
                return false;
            });
            // logout
            $(document).on('click', '#logout-link', function(){
                $.get(
                    '{% url 'logout' %}',  
                    // data
                    {},  
                    // callback
                    function(json){
                        $("#signin-icon").show();
                        $("#posting-icon").hide();
                        $("#request-icon").hide();
                        $("#header_show_img").hide();
                        $("#welcome").removeClass().addClass("header-user-name");
                        $("#welcome-list").removeClass();
                        $("a#user_protrait").text("My Account");
                        $("a#user_protrait").attr("href", "");
                    },
                )
            });

            var lng = $('#singleMap').data('longitude');
            var lat = $('#singleMap').data('latitude');
            var geocoder;
            geocoder = new google.maps.Geocoder();
            function geocodePosition(pos){
                geocoder.geocode({
                    latLng: pos
                }, function(responses){
                    if (responses && responses.length > 0) {
                        console.log(responses[0].formatted_address)
                        $('#accommodation_add').text(responses[0].formatted_address);
                    } else {
                        $('#accommodation_add').text(''); 
                    }
                });
            }
            $(window).load(geocodePosition(new google.maps.LatLng(lat, lng)));
            
            
        </script>          
    </body>
</html>
